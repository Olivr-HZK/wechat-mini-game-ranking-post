# 解决 Google OAuth 403 错误指南

## 错误信息

```
错误 403： access_denied
"video_test"尚未完成 Google 验证流程
```

## 问题原因

你的Google Cloud项目还在"测试"状态，只有添加到"测试用户"列表的邮箱才能使用OAuth功能。

## 解决步骤

### 方法1：添加测试用户（推荐，最简单）

1. **访问 Google Cloud Console**
   - 打开 https://console.cloud.google.com/
   - 选择你的项目（video_test）

2. **进入OAuth同意屏幕**
   - 左侧菜单：`API和服务` > `OAuth同意屏幕`

3. **添加测试用户**
   - 找到"测试用户"部分
   - 点击 `+ 添加用户` 按钮
   - **输入你的Google账号邮箱**：`Oliverplatinum@outlook.com`
   - 点击"添加"

4. **等待生效**
   - 添加后可能需要等待几分钟
   - 如果立即测试仍然失败，等待5-10分钟后重试

5. **重新运行测试**
   ```bash
   python test_gdrive_upload.py
   ```

### 方法2：检查邮箱是否正确

**重要**：确保你添加的测试用户邮箱与你登录Google时使用的邮箱**完全一致**。

- 如果你使用 `Oliverplatinum@outlook.com` 登录，就添加这个邮箱
- 如果你使用其他邮箱（如Gmail），就添加那个邮箱

### 方法3：发布应用（不推荐，需要验证）

如果你想让任何人都能使用（不需要添加测试用户），需要：

1. 完成OAuth同意屏幕的所有配置
2. 提交Google进行验证（可能需要几天时间）
3. 通过验证后才能发布

**对于个人使用，建议使用方法1（添加测试用户）**

## 详细步骤截图说明

### 步骤1：找到OAuth同意屏幕

1. 登录 https://console.cloud.google.com/
2. 选择你的项目
3. 左侧菜单：`API和服务` > `OAuth同意屏幕`

### 步骤2：查看测试用户部分

在OAuth同意屏幕页面，向下滚动找到"测试用户"部分。

### 步骤3：添加测试用户

1. 点击 `+ 添加用户` 按钮
2. 在弹出的对话框中输入你的邮箱
3. 点击"添加"

### 步骤4：确认添加成功

添加后，你的邮箱应该出现在测试用户列表中。

## 常见问题

### Q1: 添加了测试用户还是403错误？

**A**: 可能的原因：
- 等待时间不够（添加后等待5-10分钟）
- 邮箱不匹配（检查登录邮箱和添加的邮箱是否一致）
- 使用了错误的Google账号登录

### Q2: 如何查看我当前使用的Google账号？

**A**: 
- 在浏览器中访问 https://myaccount.google.com/
- 查看右上角显示的邮箱

### Q3: 可以添加多个测试用户吗？

**A**: 可以！你可以添加多个邮箱作为测试用户。

### Q4: 测试用户有数量限制吗？

**A**: 测试用户最多可以添加100个。

## 验证是否解决

完成上述步骤后，重新运行测试：

```bash
python test_gdrive_upload.py
```

如果成功，你应该能看到：
- 浏览器自动打开进行OAuth认证
- 能够成功授权
- 视频上传成功
- 获取到Google Drive链接

## 如果仍然无法解决

1. **检查项目状态**：
   - 确保项目已启用Google Drive API
   - 确保OAuth同意屏幕配置完整

2. **清除token并重新认证**：
   ```bash
   # 删除旧的token文件
   rm token.json  # Windows: del token.json
   
   # 重新运行测试
   python test_gdrive_upload.py
   ```

3. **检查凭证文件**：
   - 确保 `credential.json` 或 `credentials.json` 文件格式正确
   - 确保文件在项目根目录

4. **查看详细错误**：
   - 运行测试时查看完整的错误信息
   - 根据错误信息进一步排查
